---
layout: post
title: '文章流中插入广告'
subtitle: '创收ing'
date: 2018-02-13
categories: liquid
tags: liquid 广告 文章流

---
就像你们知道的一样~~（大家：我们不知道）~~，我的博客接入了谷歌广告服务。最近几天我在想“如何将广告隔n个文章后显示一个”以此来对我的广告出现率大大提高。

**这个问题是一门逻辑问题。**

下面请看我的实现方法。快速导航：[每个文章下面都加入广告](#每个文章下面都加入广告)  [在n个文章后添加广告](#在n个文章后添加广告)

<h3 id="每个文章下面都加入广告">每个文章下面都加入广告</h3>

如果是每个文章下面都加入广告，那么你可以这么干：

```html
<main class="g-container home-content">
    <div class="article-list">
        {% for post in paginator.posts %}
            <article class="article-item">
                {% if post.cover %}
                <div class="post-cover">
                    <a class="post-link" href="{{ post.url | prepend: site.baseurl }}" title="{{ post.title }}"></a>
                    <img src="{{ post.cover }}" href="{{ post.url | prepend: site.baseurl }}" alt="">
                </div>
                {% endif %}
                <section class="post-preview">
                    <a class="post-link" href="{{ post.url | prepend: site.baseurl }}" title="{{ post.title }}"></a>
                    <h2 class="post-title">{{ post.title }}</h2>
                    {% if post.subtitle %}
                    <h3 class="post-subtitle">{{ post.subtitle }}</h3>
                    {% endif %}
                    {% if post.subtitle.size==0 or post.subtitle==nil %}
                    <p class="post-excerpt">{{ post.excerpt | strip_html | strip_newlines | truncate: 126}}</p>
                    {% endif %}
                </section>
                <footer class="post-meta">
                    <div class="post-tags">
                        {% if post.tags.size > 0 %}
                            {% for tag in post.tags  %}
                            <a href={{ "tags.html#" | append: tag | pretend: site.baseurl}} class="post-tag">{{ tag }}</a>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <time class="post-date" datetime="{{ post.date | date:"%y-%m-%d" }}">{{ post.date | date_to_string }}</time>
                </footer>
            </article>
        <!--You AD code-->
        <!--You AD code End-->
        {% endfor %}

        {% if paginator.total_pages > 1 %}
            {% include pageNav.html %}
        {% endif %}

    </div>
```

不过我完全不建议这种形式，这样子的话广告绝对很烦的。我敢保证，你这样子搞你都会想着`Why I want to 'f**k me'?`。

<h3 id="在n个文章后添加广告">在n个文章后添加广告</h3>

接下来这里是我们这篇文章的重点内容，隔一些文章后插入广告。

我准备这样子实现：

```html
<!--
<main class="g-container home-content">
    <div class="article-list">
        <!--这里新建posts_for变量，设为0，每次调用自身加1-->
        <!--
	    {% increment posts_for = 0 %}
        {% for post in paginator.posts %}
            <article class="article-item">
                <!--调用posts_for变量-->
                <!--
			    {% increment posts_for %}
                {% if post.cover %}
                <div class="post-cover">
                    <a class="post-link" href="{{ post.url }}" title="{{ post.title }}"></a>
                    <img src="{{ post.cover }}" alt="">
                </div>
                {% endif %}
                <section class="post-preview">
                    <a class="post-link" href="{{ post.url }}" title="{{ post.title }}"></a>
                    <h2 class="post-title">{{ post.title }}</h2>
                    {% if post.subtitle %}
                    <h3 class="post-subtitle">{{ post.subtitle }}</h3>
                    {% endif %}
                    {% if post.subtitle.size==0 or post.subtitle==nil %}
                    <p class="post-excerpt">{{ post.excerpt | strip_html | strip_newlines | truncate: 126}}</p>
                    {% endif %}
                </section>
                <footer class="post-meta">
                    <div class="post-tags">
                        {% if post.tags.size > 0 %}
                            {% for tag in post.tags  %}
                            <a href={{ "tags.html#" | append: tag | pretend: site.baseurl}} class="post-tag">{{ tag }}</a>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <time class="post-date" datetime="{{ post.date | date:"%y-%m-%d" }}">{{ post.date | date_to_string }}</time>
                </footer>
            </article>
            <!--广告插入-->
            <!--
            {% if site.googleads.indexposts %}
			{% if site.paginate > 3 %}
			    {% assign temp = posts_for | divided_by: 2.0 %}
				{% assign temp2 = temp | floor %}
			    {% if posts_for != site.paginate and temp > temp2 and temp < temp+1 or temp > temp2-1 and temp < temp2 %}
				    {% break %}
				{% else %}
				    <ins class="adsbygoogle"
			            style="display:block"
			            data-ad-format="fluid"
			            data-ad-layout-key="-fg+4m+ac-en-5l"
			            data-ad-client="ca-pub-9833352239491773"
			            data-ad-slot="3283458874"></ins>
		            <script>
			            (adsbygoogle = window.adsbygoogle || []).push({});
		            </script>
				{% endif %}
			{% endif %}
            {% endif %}
        {% endfor %}
-->
```

如果是可行性的话，你看一下我的这张图

![](https://github.com/sctop/WebSideFile/raw/master/sctop.github.io/20180213/%E6%96%87%E7%AB%A0%E6%B5%81%E9%9A%94n%E4%B8%AA%E6%96%87%E7%AB%A0%E5%90%8E%E6%8F%92%E5%85%A5%E5%B9%BF%E5%91%8A.png)

让我们来逐个逐个看代码的作用

首先我定义了一个变量，是`posts_for`，这个变量被我初始化成0，每次调用时都将自己加1，以此统计文章的所有数量。

然后，我在`{% for %}`循环里调用`posts_for`。

一篇文章的超链接写完之后，后面的那段代码是我们这期重点讲的。

`{% if site.googleads.indexposts %}`判断是否开启“首页文章广告”，如果开启了才执行

`{% if site.paginate > 3 %}`，先判断是否每页显示的文章页数是否大于3，以便不在文章尾部加入广告。*（作者注：我在文章后面加入了广告，所以需要这段判断）*

`{% assign temp = posts_for | divided_by: 2.0 %}`将`posts_for`除以浮点数2.0，这样得出来的浮点数被存储到变量temp里。

`{% assign temp2 = temp | floor %}`，将temp里的值转换为最接近的整数。

`{% if posts_for != site.paginate and temp > temp2 and temp < temp+1 or temp > temp2-1 and temp < temp2 %}`说的是，*（可选）*
**首先我们确认不在文章的最后面*(作者注：我在文章后面加入了广告，如果不判断这个文章后面就会有两个广告，如果没有加可以忽略)。***，然后我们判断。判断一共有这几种情况：

1. `temp`变量里的数字是整数的浮点数形式
2. `temp`变量里的值四舍五入后大于`temp2`
3. `temp`变量里的值四舍五入后小于`temp2`

而我们总有方法确认是否是浮点数：

1. 第一个情况就是`temp`无论如何都不能用大于和小于号来表示`temp2`、`temp2+1`、`temp2-1`的关系。（`false`，并不是浮点数）
2. 第二、三个情况是`temp`可以用大于小于来表示`temp2`、`temp2+1`、`temp2-1`的关系。（`true`，是浮点数）

如果是浮点数，那么`{% break %}`跳出，反之插入广告。然后继续循环判断。

****

-----问题时间-----

Q 为什么我们可以通过大于小于判断是否是浮点数

A 浮点数（小数）是介于某两个数[1]之间的。但是整数的浮点数形式并不是这样，它就是一个完完全全的数字，并不介于某两个数之间。通过返回的布尔值，我们便可以知道是否是浮点数了。

Q `temp2`、`temp2+1`、`temp2-1`，为什么要用这些数来跟`temp`比较？

A `temp2`是指`temp`四舍五入的值：要么比`temp`大，要么比`temp`小。`temp2+1`指的是，如果`temp`大于`temp2`，那么就看看`temp`是否小于`temp+1`的值。`temp-1`指的是，如果`temp`小于`temp2`，那么用`temp-1`来判断是否小于其。事实上，简单地说，这些值的作用就是确认其是否是浮点数（小数），因为浮点数肯定置于这些数之间。

[1] “某两个数”指的是`temp2`四舍五入的值和`temp-1`（`temp2`大于`temp`） `temp+1`（`temp2`小于`temp`）。

****

注意：无论你是隔3、4、5还是6篇文章后显示广告，这段代码依然适用。

下面是这段代码：

插入在`{% for  ... %}`之前的

```
{% increment posts_for = 0 %}
```

插入在`{% for ... %}`循环内，`<article>`标签开始第一行

```
{% increment posts_for = 0 %}
```

插入在`</article>`末尾，`{% emdfor %}`之前

```
<!--
{% if site.paginate > 3 %}
	{% assign temp = posts_for | divided_by: 2.0 %}
	{% assign temp2 = temp | floor %}
	{% if posts_for != site.paginate and temp > temp2 and temp < temp+1 or temp > temp2-1 and temp < temp2 %}
		{% break %}
	{% else %}
    <!--广告代码-->
    <!--
	<ins class="adsbygoogle"
		style="display:block"
		data-ad-format="fluid"
		data-ad-layout-key="-fg+4m+ac-en-5l"
		data-ad-client="ca-pub-9833352239491773"
		data-ad-slot="3283458874"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
	{% endif %}
{% endif %}
-->
```

这段代码适用于各种广告，百度谷歌搜狗~~360~~。emm，学会合理安排广告位置也是站长必学的一项技能。在下期我会讲解这个博客模板哪里可以使用广告哦~

P.S 使用前请将注释去掉